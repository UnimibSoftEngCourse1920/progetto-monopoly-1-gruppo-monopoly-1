
<html lang="en">
<head>
  <title>
    Game
  </title>
    <style>

        .column, #centro {
            float: left;
            margin-top: -6;
        }

        #div1 {
            margin-left: -6;
        }

        #div2 {
            margin-right: -100;
        }

        #row {
            display: none;
            margin-top: 0;
            padding: 0;
            text-align: center;
            z-index: 0;
        }

        #board {
            border-style: solid;
        }
        #buyProperty{
          display: none;
          text-align: center;
          position:absolute;
          z-index: 2;
        }
        #gestore{
           display: none;
	         text-align: center;
	         position:absolute;
	         z-index: 1;
           background-color:white;
        }
        #buyhouse{
           display: none;
	         text-align: center;
	         position:absolute;
	         z-index: 5;
        }
        #housenumber{
           display: none;
	         text-align: center;
	         position:absolute;
	         z-index: 6;
        }
        #tradepage{
           display: none;
	         text-align: center;
	         position:absolute;
	         z-index: 3;
        }
        #abbandonagioco{
           display: none;
	         text-align: center;
	         position:absolute;
	         z-index: 7;
        }
        #haiperso{
           display: none;
	         text-align: center;
	         position:absolute;
	         z-index: 8;
        }
        #offer{
           display: none;
	         text-align: center;
	         position:absolute;
	         z-index: 4;
        }
        #dado{
          visibility:hidden;
        	font-size: 30px;
        	border-radius: 10px;
        	background-color: black;
        	border-color:black;
        	border-style:solid;
        	transition-duration: 0.3s;
        	color:white;
        	font-family: verdana, sans-serif;
        }
        #dado:hover{
        	color:black;
        	background-color: white;
        }
        .infoPlayer{
          cursor: pointer;
          font-size: 23px;
          border-style: solid;
          border-color:black;
          border-radius: 10px;
          font-family:verdana, sans-serif;
        }
        .housebutton{
          display:none;
        }
        #scrollBox{
          margin:auto;
          overflow:auto;
          height:100px;
          width:300px;
          border-style: solid;
          border-radius: 5px;
        }
        .position{
          background-color:white;
          border-radius: 10px;
          border-style:solid;
        }
        #description{
          border-style: solid;
          width:300px;
          margin:auto;
          font-size: 20px;
        }
        #endmenu{
          visibility:hidden;
        }
        #u1,#u3,#l1,#l3{
          color:brown;
        }
        #u6,#u8,#u9,#l6,#l8,#l9{
          color:lightblue;
        }
        #u11,#u13,#u14,#l11,#l13,#l14{
          color:pink;
        }
        #u16,#u18,#u19,#l16,#l18,#l19{
          color:orange;
        }
        #u21,#u23,#u24,#l21,#l23,#l24{
          color:red;
        }
        #u26,#u27,#u29,#l26,#l27,#l29{
          color:yellow;
        }
        #u31,#u32,#u34,#l31,#l32,#l34{
          color:green;
        }
        #u37,#u39,#l37,#l39{
          color:darkblue;
        }
        #u12,#u28,#l12,#l28{
          color:gray;
        }
        #u5,#u15,#u25,#u35,#l5,#l15,#l25,#l35{
          color:black;
        }
        .io,.loro,.iodiv,.lorodiv,#playername{
          display:none;
        }
        #them{
          visibility:visible;
        }
        #payjail,#getoutofjailfree{
          visibility:hidden;
        }
    </style>
    <script src="http://localhost:1337/client/js/socket.io-1.4.5.js"></script>
    <script src="http://localhost:1337/client/js/Classes.js"></script>
    <script src="http://localhost:1337/client/js/jquery-3.4.1.min.js"></script>
</head>
<body style="background-color:#06C3B6;">
	<div id="waitingDiv">
		waiting...
	</div>
  <div id="offer" class="position">
    <div id="offerreceiver"></div>
    <div id="offerproposer"></div>
    <button id="accept" onclick="offerAccepted()">Accept</button>
    <button id="decline" onclick="offerDeclined()">Decline</button>
  </div>
  <div id="buyhouse" class="position">
    <div>seleziona la proprietà in cui vuoi costruire delle case</div><br><br><br>
    <button onclick="annullaBuild()">annulla</button>
  </div>
  <div id="housenumber" class="position">
    <div>inserisci il numero di case che vuoi comprare nella proprietà</div>
    <div id="propname"></div>
    <select id="optionBox">
      <option id="opt-5" value="-5">rimuovi albergo</option>
      <option id="opt-4" value="-4">-4</option>
      <option id="opt-3" value="-3">-3</option>
      <option id="opt-2" value="-2">-2</option>
      <option id="opt-1" value="-1">-1</option>
      <option id="opt1" value="1">1</option>
      <option id="opt2" value="2">2</option>
      <option id="opt3" value="3">3</option>
      <option id="opt4" value="4">4</option>
      <option id="opt5" value="1">Albergo</option>
    </select>
    <button onclick="caseComprate()">conferma</button>
    <button onclick="showHouseButton()">torna alla pagina precedente</button>
  </div>
  <div id="tradepage" class='position'>
    <div>seleziona il player con cui vuoi fare un trade cliccando sul player apposito a destra o sinistra</div>
    <input type="text" value="0" id="ourmoney" >
    <input type="text" value="0" id="theirmoney" >
    <button id="propose" onclick="proposeTrade()">propose trade</button>
    <button id="cancel" onclick="cancelTrade()">cancel trade</button>
  </div>
  <div id="haiperso" class='position'>
    Hai perso!
  </div>
  <div id="abbandonagioco" class='position'>
    <div>Are you sure you want to declare bankruptcy?</div><br><br><br>
    <button id="exit" onclick="bankrupt()">Yes</button>
    <button id="noexit" onclick="noExit()">No</button>
  </div>
  <div id="gestore" class='position'>
    <div id="endmenu">
      <button id="build" onclick="showHouseButton()">Build houses</button>
      <button id="trade" onclick="trade()">Trade</button>
      <button id="end" onclick="endTurn()">End turn</button><br>
    </div>
    <button id="dado" onclick="rolldice()">Roll dice</button><br>
    <div id="scrollBox"></div>
    <button id="payjail" onclick="payJail()">Pay Jail</button>
    <button id="getoutofjailfree" onclick="getOutOfJailFree()">Use "Get out of jail free" card</button>
    <button id="bankrupt" onclick="declareBankruptcy()">Declare bankruptcy</button>
	</div>
  <div id="buyProperty" class="position">
    <div id="description"></div><br>
    <div>vuoi acquistare questa propietà?</div><br>
    <button id="yes" onclick="propertyRisp(true)">yes</button>
    <button id="auction" onclick="propertyRisp(false)">auction</button>
  </div>
    <div id="row">
        <div class="column" id="div1">
            <div id="p0" class="infoPlayer"></div>
            <div id="m0"></div><br>
            <div id="p1" class="infoPlayer"></div>
            <div id="m1"></div><br>
            <div id="p2" class="infoPlayer"></div>
            <div id="m2"></div><br><br>
            <div id="us">
              <div>Le tue proprietà</div>
              <input id="cu1" type="checkbox" class="io" value="1"><div id="u1" class = "iodiv">Mediterranean Avenue</div><button id="b1" class="housebutton" onclick="buyHouses(1)">seleziona</button>
              <input id="cu3" type="checkbox" class="io" value="3"><div id="u3" class = "iodiv">Baltic Avenue</div><button id="b3" class="housebutton" onclick="buyHouses(3)">seleziona</button>
              <input id="cu6" type="checkbox" class="io" value="6"><div id="u6" class = "iodiv">Oriental Avenue</div><button id="b6" class="housebutton" onclick="buyHouses(6)">seleziona</button>
              <input id="cu8" type="checkbox" class="io" value="8"><div id="u8" class = "iodiv">Vermont Avenue</div><button id="b8" class="housebutton" onclick="buyHouses(8)">seleziona</button>
              <input id="cu9" type="checkbox" class="io" value="9"><div id="u9" class = "iodiv">Connecticut Avenue</div><button id="b9" class="housebutton" onclick="buyHouses(9)">seleziona</button>
              <input id="cu11" type="checkbox" class="io" value="11"><div id="u11" class = "iodiv">St. Charles Place</div><button id="b11" class="housebutton" onclick="buyHouses(11)">seleziona</button>
              <input id="cu13" type="checkbox" class="io" value="13"><div id="u13" class = "iodiv">States Avenue</div><button id="b13" class="housebutton" onclick="buyHouses(13)">seleziona</button>
              <input id="cu14" type="checkbox" class="io" value="14"><div id="u14" class = "iodiv">Viriginia Avenue</div><button id="b14" class="housebutton" onclick="buyHouses(14)">seleziona</button>
              <input id="cu16" type="checkbox" class="io" value="16"><div id="u16" class = "iodiv">St. James Place</div><button id="b16" class="housebutton" onclick="buyHouses(16)">seleziona</button>
              <input id="cu18" type="checkbox" class="io" value="18"><div id="u18" class = "iodiv">Tennessee Avenue</div><button id="b18" class="housebutton" onclick="buyHouses(18)">seleziona</button>
              <input id="cu19" type="checkbox" class="io" value="19"><div id="u19" class = "iodiv">New York Avenue</div><button id="b19" class="housebutton" onclick="buyHouses(19)">seleziona</button>
              <input id="cu21" type="checkbox" class="io" value="21"><div id="u21" class = "iodiv">Kentucky Avenue</div><button id="b21" class="housebutton" onclick="buyHouses(21)">seleziona</button>
              <input id="cu23" type="checkbox" class="io" value="23"><div id="u23" class = "iodiv">Indiana Avenue</div><button id="b23" class="housebutton" onclick="buyHouses(23)">seleziona</button>
              <input id="cu24" type="checkbox" class="io" value="24"><div id="u24" class = "iodiv">Illinois Avenue</div><button id="b24" class="housebutton" onclick="buyHouses(24)">seleziona</button>
              <input id="cu26" type="checkbox" class="io" value="26"><div id="u26" class = "iodiv">Atlantic Avenue</div><button id="b26" class="housebutton" onclick="buyHouses(26)">seleziona</button>
              <input id="cu27" type="checkbox" class="io" value="27"><div id="u27" class = "iodiv">Ventnor Avenue</div><button id="b27" class="housebutton" onclick="buyHouses(27)">seleziona</button>
              <input id="cu29" type="checkbox" class="io" value="29"><div id="u29" class = "iodiv">Marvin Gardens</div><button id="b29" class="housebutton" onclick="buyHouses(29)">seleziona</button>
              <input id="cu31" type="checkbox" class="io" value="31"><div id="u31" class = "iodiv">Pacific Avenue</div><button id="b31" class="housebutton" onclick="buyHouses(31)">seleziona</button>
              <input id="cu32" type="checkbox" class="io" value="32"><div id="u32" class = "iodiv">North Carolina Avenue</div><button id="b32" class="housebutton" onclick="buyHouses(32)">seleziona</button>
              <input id="cu34" type="checkbox" class="io" value="34"><div id="u34" class = "iodiv">Pennsylvania Avenue</div><button id="b34" class="housebutton" onclick="buyHouses(34)">seleziona</button>
              <input id="cu37" type="checkbox" class="io" value="37"><div id="u37" class = "iodiv">Park Place</div><button id="b37"class="housebutton" onclick="buyHouses(37)">seleziona</button>
              <input id="cu39" type="checkbox" class="io" value="39"><div id="u39" class = "iodiv">Boardwalk</div><button id="b39"class="housebutton" onclick="buyHouses(39)">seleziona</button>
              <input id="cu12" type="checkbox" class="io" value="12"><div id="u12" class = "iodiv">Electric Company</div>
              <input id="cu28" type="checkbox" class="io" value="28"><div id="u28" class = "iodiv">Water Works</div>
              <input id="cu5" type="checkbox" class="io" value="5"><div id="u5" class = "iodiv">Reading Railroad</div>
              <input id="cu15" type="checkbox" class="io" value="15"><div id="u15" class = "iodiv">Pennsylvania Railroad</div>
              <input id="cu25" type="checkbox" class="io" value="25"><div id="u25" class = "iodiv">B. & O. Railroad</div>
              <input id="cu35" type="checkbox" class="io" value="35"><div id="u35" class = "iodiv">Short Line</div>
            </div>
        </div>
        <div id="centro">
            <canvas id="board"></canvas>
        </div>
        <div class="column" id="div2">
            <div id="p3" class="infoPlayer"></div>
            <div id="m3"></div><br>
            <div id="p4" class="infoPlayer"></div>
            <div id="m4"></div><br>
            <div id="p5" class="infoPlayer"></div>
            <div id="m5"></div><br><br>
            <div id="them">
              <div id="playername"></div>
              <input id="cl1" type="checkbox" class="loro" value="1"><div id="l1" class="lorodiv" >Mediterranean Avenue</div>
              <input id="cl3" type="checkbox" class="loro" value="3"><div id="l3" class="lorodiv" >Baltic Avenue</div>
              <input id="cl6" type="checkbox" class="loro" value="6"><div id="l6" class="lorodiv" >Oriental Avenue</div>
              <input id="cl8" type="checkbox" class="loro" value="8"><div id="l8" class="lorodiv" >Vermont Avenue</div>
              <input id="cl9" type="checkbox" class="loro" value="9"><div id="l9" class="lorodiv" >Connecticut Avenue</div>
              <input id="cl11" type="checkbox" class="loro" value="11"><div id="l11" class="lorodiv" >St. Charles Place</div>
              <input id="cl13" type="checkbox" class="loro" value="13"><div id="l13" class="lorodiv" >States Avenue</div>
              <input id="cl14" type="checkbox" class="loro" value="14"><div id="l14" class="lorodiv" >Viriginia Avenue</div>
              <input id="cl16" type="checkbox" class="loro" value="16"><div id="l16" class="lorodiv" >St. James Place</div>
              <input id="cl18" type="checkbox" class="loro" value="18"><div id="l18" class="lorodiv" >Tennessee Avenue</div>
              <input id="cl19" type="checkbox" class="loro" value="19"><div id="l19" class="lorodiv" >New York Avenue</div>
              <input id="cl21" type="checkbox" class="loro" value="21"><div id="l21" class="lorodiv" >Kentucky Avenue</div>
              <input id="cl23" type="checkbox" class="loro" value="23"><div id="l23" class="lorodiv" >Indiana Avenue</div>
              <input id="cl24" type="checkbox" class="loro" value="24"><div id="l24" class="lorodiv" >Illinois Avenue</div>
              <input id="cl26" type="checkbox" class="loro" value="26"><div id="l26" class="lorodiv" >Atlantic Avenue</div>
              <input id="cl27" type="checkbox" class="loro" value="27"><div id="l27" class="lorodiv" >Ventnor Avenue</div>
              <input id="cl29" type="checkbox" class="loro" value="29"><div id="l29" class="lorodiv" >Marvin Gardens</div>
              <input id="cl31" type="checkbox" class="loro" value="31"><div id="l31" class="lorodiv" >Pacific Avenue</div>
              <input id="cl32" type="checkbox" class="loro" value="32"><div id="l32" class="lorodiv" >North Carolina Avenue</div>
              <input id="cl34" type="checkbox" class="loro" value="34"><div id="l34" class="lorodiv" >Pennsylvania Avenue</div>
              <input id="cl37" type="checkbox" class="loro" value="37"><div id="l37" class="lorodiv" >Park Place</div>
              <input id="cl39" type="checkbox" class="loro" value="39"><div id="l39" class="lorodiv" >Boardwalk</div>
              <input id="cl12" type="checkbox" class="loro" value="12"><div id="l12" class="lorodiv" >Electric Company</div>
              <input id="cl28" type="checkbox" class="loro" value="28"><div id="l28" class="lorodiv" >Water Works</div>
              <input id="cl5" type="checkbox" class="loro" value="5"><div id="l5" class="lorodiv" >Reading Railroad</div>
              <input id="cl15" type="checkbox" class="loro" value="15"><div id="l15" class="lorodiv" >Pennsylvania Railroad</div>
              <input id="cl25" type="checkbox" class="loro" value="25"><div id="l25" class="lorodiv" >B. & O. Railroad</div>
              <input id="cl35" type="checkbox" class="loro" value="35"><div id="l35" class="lorodiv" >Short Line</div>
            </div>
        </div>
    </div>
<script>
	let socket, id;
  let lobbyID;
  let squares = [];
  let houses = [];
  let players = [];
  let pedinaPos = [];
  let playersTemp = [];
  let player;
  let self;
  let dpi = window.devicePixelRatio;
  let img = new Image();
  let canvas = document.getElementById("board");
  let ctx = canvas.getContext("2d");
  let turn;
  let tradeState = false;
  let ourProps=[];
  let theirProps=[];
  let ourMoney=0;
  let theirMoney=0;
  let receiver;
  let proposer;
  let payedOff = true;
  let moneyOwed = 0;
  let ownerOwed = null;
  let brown;
  let lightblue;
  let pink;
  let orange;
  let red;
  let yellow;
  let green;
  let darkblue;
  let xyz=0;;
  socket = io();

  socket.emit('getId');

  socket.on('id', function (data) {
        id = data.id;
        let playerName = "Player " + id;
        socket.emit('getLobby', { name: playerName });
  });

  socket.on('setLobby', function (data) {
    lobbyID = data.lobbyID;
  });

  socket.on('startGame', function (data) {
      waitingDiv.style.display = 'none';
      row.style.display = 'block';
      gestore.style.display = 'block';
      playersTemp = data;
      let colors = ["#FF0000", "#0000E6", "#FFFF00", "#FF80FF", "#FFA64D", "#A31AFF"];
      for (let i = 0; i < playersTemp.length; i ++) {
          let pedina = new Pedina(colors[i]);
          players[i] = new Player(playersTemp[i].id, playersTemp[i].name, pedina);
          let p = "p" + i;
          let m= "m" + i;
          console.log(playersTemp[i].id + " " + playersTemp[i].name);
          if(players[i].id==id){
            self = players[i];
            document.getElementById(p).innerHTML =  "(sei tu) " + players[i].name;

          }else{
            document.getElementById(p).innerHTML = players[i].name;
          }
          document.getElementById(m).innerHTML =  "money: " + players[i].money;
          document.getElementById(p).style.background=colors[i];
      }
      createCanvas();
  });

  let createCanvas = function () {
    let H = $(window).height();
    let W = $(window).width();
    let a = (W - H) / 2;
    canvas.style.height = H - 10;
    canvas.style.width = H - 10;
    let boardW=$("#centro").width();
    let cas= boardW*(200/1500);
    $(".column").width(a);
    $(".position").width(boardW-(cas*3));
    $(".position").offset({ top: cas+100,left:(cas*1.5) + $(".column").width() });
    fix_dpi();
    createSquares();
    img.onload = function () {
      paint();
    }
    img.src = "http://localhost:1337/client/img/monopoly.png";
  }

  function fix_dpi() {
    let style_height = +getComputedStyle(canvas).getPropertyValue("height").slice(0, -2);
    let style_width = +getComputedStyle(canvas).getPropertyValue("width").slice(0, -2);
    canvas.setAttribute('height', style_height * dpi);
    canvas.setAttribute('width', style_width * dpi);
  }

  let createSquares = function() {
    //let boardW=$("#board").width();
    let boardW = canvas.width;
    let w=boardW/1500;
    let calcola=function(i){
      return (i*w);
    }
    let width = calcola(35);
    for (let i = 0; i < players.length; i ++) {
      players[i].pedina.setDimensions(width, width);
    }

    squares[0]= new Casella(boardW-calcola(200),boardW-calcola(200),0);
    squares[1]=new Casella(squares[0].x-calcola(123),squares[0].y,1);
    houses[1] = new House(squares[1].x+calcola(35), squares[1].y-calcola(10));
    squares[2]=new Casella(squares[1].x-calcola(122),squares[0].y,1);
    squares[3]=new Casella(squares[2].x-calcola(123),squares[0].y,1);
    houses[3] = new House(squares[3].x+calcola(35), squares[3].y-calcola(10));
    squares[4]= new Casella(squares[3].x-calcola(122),squares[0].y,1);
    squares[5]= new Casella(squares[4].x-calcola(125),squares[0].y,1);
    squares[6]= new Casella(squares[5].x-calcola(123),squares[0].y,1);
    houses[6] = new House(squares[6].x+calcola(35), squares[6].y-calcola(10));
    squares[7]= new Casella(squares[6].x-calcola(122),squares[0].y,1);
    squares[8]= new Casella(squares[7].x-calcola(123),squares[0].y,1);
    houses[8] = new House(squares[8].x+calcola(35), squares[8].y-calcola(10));
    squares[9]= new Casella(squares[8].x-calcola(122),squares[0].y,1);
    houses[9] = new House(squares[9].x+calcola(35), squares[9].y-calcola(10));
    squares[10]= new Casella(0,squares[0].y,0);
    squares[11]= new Casella(0,squares[10].y-calcola(123),2);
    houses[11] = new House(squares[11].x+calcola(150), squares[11].y+calcola(35));
    squares[12]= new Casella(0,squares[11].y-calcola(122),2);
    squares[13]= new Casella(0,squares[12].y-calcola(123),2);
    houses[13] = new House(squares[13].x+calcola(150), squares[13].y+calcola(35));
    squares[14]= new Casella(0,squares[13].y-calcola(122),2);
    houses[14] = new House(squares[14].x+calcola(150), squares[14].y+calcola(35));
    squares[15]= new Casella(0,squares[14].y-calcola(125),2);
    squares[16]= new Casella(0,squares[15].y-calcola(123),2);
    houses[16] = new House(squares[16].x+calcola(150), squares[16].y+calcola(35));
    squares[17]= new Casella(0,squares[16].y-calcola(122),2);
    squares[18]= new Casella(0,squares[17].y-calcola(123),2);
    houses[18] = new House(squares[18].x+calcola(150), squares[18].y+calcola(35));
    squares[19]= new Casella(0,squares[18].y-calcola(122),2);
    houses[19] = new House(squares[19].x+calcola(150), squares[19].y+calcola(35));
    squares[20]= new Casella(0,0,0);
    squares[21]= new Casella(calcola(200),0,3);
    houses[21] = new House(squares[21].x+calcola(35), squares[21].y+calcola(150));
    squares[22]= new Casella(squares[21].x+calcola(122),0,3);
    squares[23]= new Casella(squares[22].x+calcola(123),0,3);
    houses[23] = new House(squares[23].x+calcola(35), squares[23].y+calcola(150));
    squares[24]= new Casella(squares[23].x+calcola(122),0,3);
    houses[24] = new House(squares[24].x+calcola(35), squares[24].y+calcola(150));
    squares[25]= new Casella(squares[24].x+calcola(123),0,3);
    squares[26]= new Casella(squares[25].x+calcola(125),0,3);
    houses[26] = new House(squares[26].x+calcola(35), squares[26].y+calcola(150));
    squares[27]= new Casella(squares[26].x+calcola(122),0,3);
    houses[27] = new House(squares[27].x+calcola(35), squares[27].y+calcola(150));
    squares[28]= new Casella(squares[27].x+calcola(123),0,3);
    squares[29]= new Casella(squares[28].x+calcola(122),0,3);
    houses[29] = new House(squares[29].x+calcola(35), squares[29].y+calcola(150));
    squares[30]= new Casella(boardW-calcola(195),0,0);
    squares[31]= new Casella(squares[30].x, calcola(200), 4);
    houses[31] = new House(squares[31].x-calcola(10), squares[31].y+calcola(35));
    squares[32]= new Casella(squares[30].x, squares[31].y+calcola(123), 4);
    houses[32] = new House(squares[32].x-calcola(10), squares[32].y+calcola(35));
    squares[33]= new Casella(squares[30].x, squares[32].y+calcola(122), 4);
    squares[34]= new Casella(squares[30].x, squares[33].y+calcola(123), 4);
    houses[34] = new House(squares[34].x-calcola(10), squares[34].y+calcola(35));
    squares[35]= new Casella(squares[30].x, squares[34].y+calcola(122), 4);
    squares[36]= new Casella(squares[30].x, squares[35].y+calcola(125), 4);
    squares[37]= new Casella(squares[30].x, squares[36].y+calcola(123), 4);
    houses[37] = new House(squares[37].x-calcola(10), squares[37].y+calcola(35));
    squares[38]= new Casella(squares[30].x, squares[37].y+calcola(122), 4);
    squares[39]= new Casella(squares[30].x, squares[38].y+calcola(123), 4);
    houses[39] = new House(squares[39].x-calcola(10), squares[39].y+calcola(35));

    for(let i=0;i<players.length;i++)
      pedinaPos[i] = [];

    pedinaPos[0][0] = new Coordinates(calcola(50), calcola(60));
    pedinaPos[0][1] = new Coordinates(calcola(20), calcola(60));
    pedinaPos[0][2] = new Coordinates(calcola(15), calcola(20));
    pedinaPos[0][3] = new Coordinates(calcola(20), calcola(15));
    pedinaPos[0][4] = new Coordinates(calcola(60), calcola(20));

    pedinaPos[1][0] = new Coordinates(calcola(50), calcola(105));
    pedinaPos[1][1] = new Coordinates(calcola(20), calcola(105));
    pedinaPos[1][2] = new Coordinates(calcola(60), calcola(20));
    pedinaPos[1][3] = new Coordinates(calcola(20), calcola(60));
    pedinaPos[1][4] = new Coordinates(calcola(105), calcola(20));

    pedinaPos[2][0] = new Coordinates(calcola(50), calcola(150));
    pedinaPos[2][1] = new Coordinates(calcola(20), calcola(150));
    pedinaPos[2][2] = new Coordinates(calcola(105), calcola(20));
    pedinaPos[2][3] = new Coordinates(calcola(20), calcola(105));
    pedinaPos[2][4] = new Coordinates(calcola(150), calcola(20));

    pedinaPos[3][0] = new Coordinates(calcola(95), calcola(60));
    pedinaPos[3][1] = new Coordinates(calcola(65), calcola(60));
    pedinaPos[3][2] = new Coordinates(calcola(15), calcola(65));
    pedinaPos[3][3] = new Coordinates(calcola(65), calcola(15));
    pedinaPos[3][4] = new Coordinates(calcola(60), calcola(65));

    pedinaPos[4][0] = new Coordinates(calcola(95), calcola(105));
    pedinaPos[4][1] = new Coordinates(calcola(65), calcola(105));
    pedinaPos[4][2] = new Coordinates(calcola(60), calcola(65));
    pedinaPos[4][3] = new Coordinates(calcola(65), calcola(60));
    pedinaPos[4][4] = new Coordinates(calcola(105), calcola(65));

    pedinaPos[5][0] = new Coordinates(calcola(95), calcola(150));
    pedinaPos[5][1] = new Coordinates(calcola(65), calcola(150));
    pedinaPos[5][2] = new Coordinates(calcola(105), calcola(65));
    pedinaPos[5][3] = new Coordinates(calcola(65), calcola(105));
    pedinaPos[5][4] = new Coordinates(calcola(150), calcola(65));


  }

  socket.on('turn', function(data) {
    turn = data;
    if (turn == self.id)
      startTurn();
  });

  let startTurn = function() {
    if (!self.jail)
      dado.style.visibility = 'visible';
    else {
      socket.emit('stillInJail', self);
      dado.style.visibility = 'visible';
      document.getElementById("payjail").style.visibility='visible';
      if(self.getOutOfJailFree) {
        document.getElementById("getoutofjailfree").style.visibility='visible';
      }
    }
  }

  let odd = 0;
  let rolldice = function() {
    dado.style.visibility='hidden';
    document.getElementById("payjail").style.visibility='hidden';
    document.getElementById("getoutofjailfree").style.visibility='hidden';
    //let x = Math.floor(Math.random() * 6) + 1;
    //let y = Math.floor(Math.random() * 6) + 1;
    let x ;
    if(odd%2==0) {
      x = 5;
    } else {
      x = 4;
    }
    let y = 5;
    odd++;
    let str = 'you rolled the dice: ' + x + ' ' + y;
    let pack = [];
    pack.push(x);
    pack.push(y);
    socket.emit('dice', pack);
    //updatePosition(x+y, str);


    //dovremo spostare
    //socket.emit('endTurn');
  }

  let getOutOfJailFree = function() {
    //getOutOfJailFree.style.visibility = 'hidden';
    socket.emit('getOutOfJailFree', self);
    document.getElementById("getoutofjailfree").style.visibility='hidden';
  }

  socket.on('getOutOfJailFreeUpdate', function(data) {
    let player = data;
    for (let i = 0; i < players.length; i ++) {
      if(players[i].id == player.id) {
        if (player.getOutOfJailFree) {
          players[i].getOutOfJailFree = player.getOutOfJailFree;
          updateScroll(player.name + ' now has a GetOutOfJailCard');
        } else {
          players[i].getOutOfJailFree = player.getOutOfJailFree;
          updateScroll(player.name + ' used his GetOutOfJailCard');
        }
      }
    }
  })

  let payJail = function() {
    if (self.money >= 50) {
      document.getElementById("payjail").style.visibility='hidden';
      socket.emit('payJail', self);
    } else {
      updateScroll("You can't leave jail as you need to pay 50 which you don't have");
    }
  }
  /*let updatePosition = function(diceNumber, str) {
    oldPos = self.pos;
    newPos = self.dicePos(diceNumber);
    updatePosPlayer(self, oldPos, newPos, str);
    socket.emit("handlePlayer", self);
  }*/

  socket.on('updatePosPlayer', function(data){
    let player = data[0];
    let desc = data[1];
    let newPos = player.pos;
    let oldPos;
    for (let i = 0; i < players.length; i ++) {
        if (players[i].id == player.id) {
          oldPos = players[i].pos;
          updatePosPlayer(players[i], oldPos, newPos, desc);
        }
    }
    if (player.id == id && !player.jail)
      socket.emit('handlePlayer', self);
  });

  let updatePosPlayer = function(player, oldPos, newPos, str) {
    player.setPos(newPos);
    let stringa = player.name + " " + str;
    updateScroll(stringa);
    paint();
    //qui dobbiamo aggiornare la pos del player sullo schermo
  }

  socket.on('genericUpdate', function(data) {
    //data è una stringa, devi solo inserirla nella scroll
    updateScroll(data);
  });

  socket.on('updateMoneyPlayer', function(data) {
    //data è un array [rent, player, description]
    let p;
    if(data[0] != 0) {
      for (let i = 0; i < players.length; i ++)
        if (players[i].id == data[1].id) {
          players[i].updateMoney(data[0]);
          p = players[i];
          let str = 'm' + p.id;
          document.getElementById(str).innerHTML = "money: " + p.money;
          if(players[i].id == self.id) {
            if(!payedOff) {
              if(self.money >= moneyOwed)
                payedOff = true;
            }
          }
        }
      updateScroll(data[2]);
    }

    //teo non so se lo fa automaticamente ma se no in questo momento deve essere aggiornata la div.
    //Crea una funzione che quando i soldi di un player (incluso self) vengono modificati, viene modificata automaticamente la div.
    //Poi altra cosa mi sa che self e player[id] puntono alla stessa are di memoria, dunque cambiare uno o l'altro dovrebbe essere la stessa cosa,
    //percui faccio un for senza fare il controllo su self, ma fai delle prove e eventualmente possiamo togliere self del tutto e
    //usare lo stesso array per tutti


  });

  socket.on('jailUpdate', function(data) {
    //data è un player, il suo stato jail è cambiato (o è uscito o è entrato, jail = true se dentro false se fuori)
    //puo essere cambiato il suo jail count, ovvero quanti turni è in prigione
    let player = data[0];
    let double = data[1];
    let str;
    for (let i = 0; i < players.length; i ++) {
      if (players[i].id == player.id) {
        players[i].jail = player.jail;
        if (player.id != self.id) {
          if (player.jail == false) {
            str = player.name + ' is out of jail';
            players[i].jailCount = 0;
            updateScroll(str);
          } else {
            str = player.name + ' is in jail';
            updateScroll(str);
          }
        } else {
          //sei tu
          if (player.jail == true) {
            //socket.emit('endturn');
          } else {
            self.jailCount = 0;
          }
        }
      }
    }

  });

  socket.on('jailCountUpdate', function(data) {
    let player = data;
    let str;
    for (let i = 0; i < players.length; i ++) {
      if (players[i].id == player.id) {
        if (player.id != self.id) {
          players[i].jailCount = player.jailCount;
          if (player.jailCount != 0) {
            str = player.name + ' is still in jail';
            updateScroll(str);
          }
        } else {
          //sei tu
          players[i].jailCount = player.jailCount;
          if (player.jailCount != 0)
            jailOptions();
        }
      }
    }
  });

  let jailOptions = function() {
    //mostra opzioni per quando sei in prigione, quindi rolldice, paga oppure usa carta se ce l'hai

  }

  let propertyRisp = function (risp){
    let str;
    if(risp){
      str="buy";
   }else {
     str="auction";
     }
     socket.emit('buyOrAuction', str);
     buyProperty.style.display="none";
     gestore.style.display="block";
  }

  socket.on('unownedProperty', function(data) {
    //data è un oggetto di tipo Property
    //questo viene ricevuto solo dal client interessato, non da tutti
    //qua bisogna mettere sul canvas due tasti, Buy e Auction per dare una scelta al giocatore, e magari mettere una descrizione della
    //property su cui è capitato (hai tutte le informazioni in Property)
    //poi ci sara un oncclick metodo che inviera al server la scelta
    //fai in modo che i due bottoni invochino la stessa funzione, che pero fa una socket.emit diversa nei due casi:
    //socket.emit('buyOrAuction', str), dove str = 'buy' o str = 'auction'
    gestore.style.display="none";
   buyProperty.style.display="block";
   let propTemp=data[1];
   let type = data[2];
   let frase;
          //sei tu
          if (type == 'HouseProperty') {

             let n = "Nome proprietà: "+ propTemp.name;
             let c=  "Costo di acquisto: "+ propTemp.cost;
             let r0= "rendita: " + propTemp.housePrices[0];
             let r1= "rendita con 1 casa: " + propTemp.housePrices[1];
             let r2= "rendita con 2 case: " + propTemp.housePrices[2];
             let r3= "rendita con 3 case: " + propTemp.housePrices[3];
             let r4= "rendita con 4 case: " + propTemp.housePrices[4];
             let r5= "rendita con albergo: " + propTemp.housePrices[5];
             let h= "costo di una casa o albergo: " + propTemp.houseBuildPrice;
             frase= n + "<br>" + c + "<br>" + r0 + "<br>"+ r1 + "<br>"+ r2 + "<br>"+ r3 + "<br>"+ r4 + "<br>"+ r5 + "<br>"+ h;
             //document.getElementById("description").style.border-color=propTemp.colour;
           } else if (type == 'Station') {

             let n = "Nome proprietà: "+ propTemp.name;
             let c=  "Costo di acquisto: "+ propTemp.cost;
             let r1= "rendita con 1 stazione: " + propTemp.rentPrices[0];
             let r2= "rendita con 2 stazioni: " + propTemp.rentPrices[1];
             let r3= "rendita con 3 stazioni: " + propTemp.rentPrices[2];
             let r4= "rendita con 4 stazioni: " + propTemp.rentPrices[3];
             frase= n + "<br>" + c + "<br>" + r1 + "<br>"+ r2 + "<br>"+ r3 + "<br>"+ r4;
           } else if (type == 'Services') {
             let n = "Nome proprietà: "+ propTemp.name;
             let c=  "Costo di acquisto: "+ propTemp.cost;
             let r0 = "Se si possiede una proprieta di tipo Services, la rendita è: 4 x il numero dei dadi tirati";
             let r1 = "Se si possiedono entrambe le proprieta di tipo Services, la rendita è: 10 x il numero dei dadi tirati";
             frase = n + "<br>" + c + "<br>" + r0 + "<br>"+ r1;
           }
           document.getElementById("description").innerHTML=frase;

  });

socket.on('addProp', function(data) {
  let playerArrived = data[1];
  let prop = data[0];
  let player = players[playerArrived.id];
  let str = data[2];
  let tipoProp = data[3];
  for (let i = 0; i < players.length; i ++) {
    if(players[i].id == player.id) {
      if (players[i].id != self.id) {
        players[i].addProp(prop);
        if(tipoProp == 1) {
          players[i].stations.push(prop);
        }
        else if(tipoProp == 2) {
          players[i].services.push(prop);
        }
        console.log(players[i].props[0].name);
        //aggiorna div
      } else {
        //sei tu
        self.addProp(prop);
        if(tipoProp == 1) {
          players[i].stations.push(prop);
        }
        else if(tipoProp == 2) {
          players[i].services.push(prop);
        }
        updateSelfProps();
        //aggiorna div
      }
    }
  }
  updateScroll(str);
})

  let updateScroll = function(str) {
    let scrollDiv= document.getElementById("scrollBox");
    let sdiv=scrollDiv.innerHTML;
    scrollDiv.innerHTML = str + "<br>" + sdiv ;
  }


  let paint = function() {
    ctx.clearRect(0, 0, canvas.width, canvas.width);
    ctx.drawImage(img, 0, 0, canvas.width, canvas.width);
    for (let i = 0; i < players.length; i ++) {
      let X = pedinaPos[i][squares[players[i].pos].type].x+squares[players[i].pos].x;
      let Y = pedinaPos[i][squares[players[i].pos].type].y+squares[players[i].pos].y;
      drawPedine(players[i].pedina, X, Y);
    }
  }

  let drawPedine = function(pedina, x, y) {
    //alert("hey");
    ctx.fillStyle = pedina.color;
    ctx.fillRect(x, y, pedina.w, pedina.h);
    ctx.fillStyle = "#000000";
    ctx.strokeRect(x, y, pedina.w, pedina.h);

  }

  socket.on('endMenu', function(data) {
    endMenu(data);
  });

  let done = false;
  let timeOutFunc;
  let intervalFunc;

  let setDone = function() {
  this.done= true;
  clearTimeout(timeOutFunc);
  }

  let setPayedOff = function() {
    payedOff = true;
    clearInterval(intervalFunc);
    moneyOwed = 0;
    ownerOwed = null;
  }
  let justPayed = false;
  let endMenu = function(data) {

    let boo = data[0];
    let money = data[1];
    let owner = data[2];
      if(justPayed) {
        justPayed = false;
        document.getElementById("end").style.display="inline";
      }
    if(boo) {
      document.getElementById("endmenu").style.visibility="visible";
    }
    else if (!boo) {
      socket.emit('debt', money);
      done = false;
      if(owner != null) {
        ownerOwed = players[owner.id];
      }
      updateScroll("You are in debt! you need to find a way to earn " + money + " or declare bankrupt");
      moneyOwed = money;
      payedOff = false;

      timeOutFunc = setTimeout(function(){ document.getElementById("endmenu").style.visibility="visible"; document.getElementById("end").style.display="none"; setDone();}, 2500);
      intervalFunc = setInterval(function() {
        if(payedOff) {
          //document.getElementById("end").style.visibility="visible";
          let pack = [money, owner]
          socket.emit('payedDebt', pack);
          document.getElementById("endmenu").style.visibility="hidden";
          justPayed = true;
          setPayedOff();
        }
      }, 300);
    }
    //opzione 1: finisci il turno => emitti socket.emit('endTurn');
    //opzione 2: costruzione case => socket.emit('houseBuild');
    //opzione 3: trading => socket.emit('trade');
    //opzione 4: dichiara bancarotta => socket.emit('bankrupt');
  }

  let endTurn = function() {
    socket.emit('endTurn');
    document.getElementById("endmenu").style.visibility="hidden";
  }

  let houseBuild = function(property, build) {
    //build è un boolean, false se togli una casa, true se costruisci
    //viene invocata sempre questa funzione una casa alla volta
    //se numCase è uguale a zero, togliere una casa vuol dire ipotecare
    let prop = self.props[property];
    let pack = [];
    pack.push(prop);
    pack.push(build);
    socket.emit('houseBuild', pack);
  }

  let trade = function() {
    document.getElementById("gestore").style.display="none";
    document.getElementById("tradepage").style.display="block";
    tradeState = true;
    updateSelfProps();
    // settare finestra

  }

  let declareBankruptcy = function() {
    document.getElementById("gestore").style.display="none";
    document.getElementById("abbandonagioco").style.display="block";
  }

  let bankrupt = function() {
    let pack = [payedOff, ownerOwed];
    socket.emit('bankrupt', pack);
    socket.disconnect();
    document.getElementById("abbandonagioco").style.display="none";
    document.getElementById("haiperso").style.display="block";
    setTimeout(function() {
      socket.disconnect();
      window.open("http://localhost:1337/client/Menu.html", "_self");
    }, 3000);
  }

  let noExit = function() {
    document.getElementById("abbandonagioco").style.display="none";
    document.getElementById("gestore").style.display="block";
  }


  socket.on('playerDisconnected', function(data) {
    let playerDisc = players[data.id];
    let pId = 'p' + playerDisc.id;
    let mId = 'm' + playerDisc.id;
    document.getElementById(pId).style.display="none";
    document.getElementById(mId).style.display="none";
    players.delete(playerDisc);
    updateScroll(playerDisc.name + ' disconnected');
  });

  p0.onclick= function(){
    viewProps(0);
  }
  p1.onclick= function(){
    viewProps(1);
  }
  p2.onclick= function(){
    viewProps(2);
  }
  p3.onclick= function(){
    viewProps(3);
  }
  p4.onclick= function(){
    viewProps(4);
  }
  p5.onclick= function(){
    viewProps(5);
  }
  $(document).ready(function(){
        $(".infoPlayer").click(function(){
          if (tradeState==true){
              $(".loro").prop("checked", false);
              $(".io").prop("checked", false);
              theirProps=[];
              ourProps=[];
              ourMoney=0;
              theirMoney=0;
              document.getElementById('ourmoney').value=0;
              document.getElementById('theirmoney').value=0;
              }
          });
        $('input[class="io"]').click(function(){
          	let a = $(this).attr("value");
            if($(this).is(":checked")){
                ourProps.push(a);
            }
            else if($(this).is(":not(:checked)")){
                ourProps.splice( ourProps.indexOf('a'), 1 );
            }
        });
		$('input[class="loro"]').click(function(){
      	let a = $(this).attr("value");
        if($(this).is(":checked")){
                theirProps.push(a);
        }
        else if($(this).is(":not(:checked)")){
              theirProps.splice( theirProps.indexOf('a'), 1 );
        }
      });

    });
    let updateSelfProps = function(){
      let arr2 = document.getElementsByClassName("iodiv");
      for (let i = 0; i < arr2.length; i ++) {
        arr2[i].style.display="none";
      }
      arr2 = document.getElementsByClassName("io");
      for (let i = 0; i < arr2.length; i ++) {
        arr2[i].style.display="none";
      }
        for (let i = 0; i < self.props.length; i ++) {
          if(self.props[i] != null) {
            let j = 'u' + self.props[i].id;
            //mostra la div della proprieta
            document.getElementById(j).style.display='block';
          } else {
            let j = 'u' + self.props[i].id;
            document.getElementById(j).style.display='none';
          }
        }
       if(tradeState) {
        //trade, quindi anche checkbox
        for (let i = 0; i < self.props.length; i ++) {
          if(self.props[i] != null) {
            let j = 'cu' + self.props[i].id;
            //mostra la div della proprieta
            document.getElementById(j).style.display='block';
          } else {
            let j = 'cu' + self.props[i].id;
            document.getElementById(j).style.display='none';
          }
        }
      }
    }
    let viewProps = function(idDiv) {
      document.getElementById("them").style.visibility='visible';
      //disattivo le div attive precedenti

      //controllo di non avere cliccato su me stesso

      if (idDiv != id) {

        document.getElementById("playername").style.display="block";
        document.getElementById("playername").innerHTML="Player " + idDiv;
        let arr = document.getElementsByClassName("lorodiv");
        for (let i = 0; i < arr.length; i ++) {
          arr[i].style.display="none";
        }
        let arr2 = document.getElementsByClassName("loro");
        for (let i = 0; i < arr2.length; i ++) {
          arr2[i].style.display="none";
        }
        //controllo se sono in stato di trading o meno
        let player = players[idDiv];
          for (let i = 0; i < player.props.length; i ++) {
            if(player.props[i] != null) {
              let j = 'l' + player.props[i].id;
              //mostra la div della proprieta
              document.getElementById(j).style.display='block';
            } else {
              let j = 'l' + player.props[i].id;
              document.getElementById(j).style.display='none';
            }
          }
         if(tradeState) {
           receiver=player;
           arr2 = document.getElementsByClassName("loro");
           for (let i = 0; i < arr2.length; i ++) {
             arr2[i].style.display="none";
           }
          //trade, quindi anche checkbox
          for (let i = 0; i < player.props.length; i ++) {
            if(player.props[i] != null) {
              let j = 'cl' + player.props[i].id;
              //mostra la div della proprieta
              document.getElementById(j).style.display='block';
            } else {
              let j = 'cl' + player.props[i].id;
              document.getElementById(j).style.display='none';
            }
          }
        }
      }
    }

    socket.on('tradeProposal', function(data) {
      proposer = data[0];
      theirProps = data[1];
      ourProps = data[2];
      theirMoney = data[3];
      ourMoney = data[4];
      let str = "";
      let str3 = "";
      document.getElementById("gestore").style.display="none";
      document.getElementById("offer").style.display="block";
      for(let i=0;i<ourProps.length;i++){
        if(ourProps != [])
          str+= ourProps[i].name + "<br>";
      }
      for(let i=0;i<theirProps.length;i++){
        if (theirProps != [])
          str3+= theirProps[i].name + "<br>";
      }
      document.getElementById("offerreceiver").innerHTML=self.name +"<br>i soldi richiesti: " + ourMoney+ "<br>Le tue proprietà richieste:<br>" + str;
      document.getElementById("offerproposer").innerHTML=proposer.name +"<br>i soldi offerti: " + theirMoney+ "<br>Le tue proprietà offerte:<br>" + str3;
    })
    let proposeTrade = function(){
      ourMoney=$("#ourmoney").val();
      theirMoney=$("#theirmoney").val();
      let pack =[receiver,ourProps,theirProps,ourMoney,theirMoney];
      socket.emit('proposeTrade', pack);
      exitTrade();
    }
    let exitTrade= function(){
      $(".loro").prop("checked", false);
      $(".io").prop("checked", false);
      theirProps=[];
      ourProps=[];
      ourMoney=0;
      theirMoney=0;
      document.getElementById('ourmoney').value=0;
      document.getElementById('theirmoney').value=0;
      document.getElementById("tradepage").style.display="none";
      document.getElementById("gestore").style.display="block";
      tradeState=false;
      if(receiver!=null && self.id!=receiver.id)
        viewProps(receiver.id);
      else {
        if(self.id == 0) {
          viewProps(1);
        }
        else {
            viewProps(0);
        }
      }
      updateSelfProps();
    }
    let cancelTrade = function(){
      exitTrade();
    }

    let offerAccepted = function() {
      sendTradeResponse(1);
    }

    let offerDeclined = function() {
      sendTradeResponse(0);
    }

    let sendTradeResponse = function(response) {
      let pack = [proposer, theirProps, ourProps, theirMoney, ourMoney, response];
      document.getElementById("gestore").style.display="block";
      document.getElementById("offer").style.display="none";
      socket.emit('tradeAnswer', pack);
      theirProps=[];
      ourProps=[];
      ourMoney=0;
      theirMoney=0;
      proposer = null;
    }

    socket.on('removeProp', function(data) {
      let prop = data[0];
      let playerArrived = data[1];
      let player = players[playerArrived.id];
      let str = data[2];
      let tipoProp = data[3];
      let boo = false;
      for (let i = 0; i < players.length; i ++) {
        if(players[i].id == player.id) {
            boo = true;
            for (let j = 0; j < players[i].props.length; j ++) {
              if(prop.id == players[i].props[j].id) {
                players[i].removeProp(players[i].props[j]);
              }
            }
            if(tipoProp == 1) {
              for (let j = 0; j < players[i].stations.length; j ++) {
                if(prop.id == players[i].stations[j].id) {
                  players[i].stations.splice(j, 1);
                }
              }
            } else if (tipoProp == 2) {
              for (let j = 0; j < players[i].services.length; j ++) {
                if(prop.id == players[i].services[j].id) {
                  players[i].services.splice(j, 1);
                }
              }
            }
          }
      }
      /*if(!boo) {
        for (let j = 0; j < self.props.length; j ++) {
          if(prop.id == self.props[j].id) {
            self.removeProp(self.props[j]);
          }
        } if(tipoProp == 1) {
          for (let j = 0; j < self.stations.length; j ++) {
            if(prop.id == self.stations[j].id) {
              self.stations.splice(j, 1);
            }
          }
        } else if (tipoProp == 2) {
          for (let j = 0; j < self.services.length; j ++) {
            if(prop.id == self.services[j].id) {
              self.services.splice(j, 1);
            }
          }
        }*/
        for (let i = 0; i < self.props.length; i ++) {
          console.log(self.props[i].name);
        }
        updateSelfProps();

      updateScroll(str);
    })
    let colorSelf=function(){
      brown=0;
      lightblue=0;
      pink=0;
      orange=0;
      red=0;
      yellow=0;
      green=0;
      darkblue=0;
      for(let i=0;i<self.props.length;i++){
        switch(self.props[i].colour){
          case "brown":
            brown++;
            break;
          case "lightblue":
            lightblue++;
            break;
          case "pink":
            pink++;
            break;
          case "orange":
            orange++;
            break;
          case "red":
            red++;
            break;
          case "yellow":
            yellow++;
            break;
          case "green":
            green++;
            break;
          case "darkblue":
            darkblue++;
            break;
          default:
            break;
        }
      }
    }
      let showHouseButton=function(){
        document.getElementById("housenumber").style.display="none";
        let bool=false;
        colorSelf();
        document.getElementById("gestore").style.display="none";
        document.getElementById("buyhouse").style.display="block";
        for (let i = 0; i < self.props.length; i ++) {
          switch(self.props[i].colour){
            case "brown":
              if(brown==2){
                bool=true;
              }
              break;
            case "lightblue":
            if(lightblue==3){
              bool=true;
            }
              break;
            case "pink":
            if(pink==3){
              bool=true;
            }
              break;
            case "orange":
            if(orange==3){
              bool=true;
            }
            break;
            case "red":
              if(red==3){
                bool=true;
              }
              break;
            case "yellow":
            if(yellow==3){
              bool=true;
            }
              break;
            case "green":
            if(green==3){
              bool=true;
            }
              break;
            case "darkblue":
            if(darkblue==2){
              bool=true;
            }
              break;
            default:
              break;
          }
          if(bool==true){
            let j = 'b' + self.props[i].id;
            document.getElementById(j).style.display='block';
            bool=false;
          }
        }
      }
      let buyHouses=function(idprop){
        let arr7 = document.getElementsByClassName("housebutton");
        for (let i = 0; i < arr7.length; i ++) {
          arr7[i].style.display="none";
        }
        let str8;
        for(let i=0;i<self.props.length;i++){
          if(self.props[i].id==idprop){
            xyz=i;
            str8=self.props[i].name;
          }
        }

          if(self.props[xyz].numHouses==0){
            $('#opt-5').hide();
            $('#opt-4').hide();
            $('#opt-3').hide();
            $('#opt-2').hide();
            $('#opt-1').hide();
            $('#opt1').show();
            $('#opt2').show();
            $('#opt3').show();
            $('#opt4').show();
            $('#opt5').hide();
            console.log("case0");
            document.getElementById('optionBox').value=2;
          }else if(self.props[xyz].numHouses==1){
            $('#opt-5').hide();
            $('#opt-4').hide();
            $('#opt-3').hide();
            $('#opt-2').hide();
            $('#opt-1').show();
            $('#opt1').show();
            $('#opt2').show();
            $('#opt3').show();
            $('#opt4').hide();
            $('#opt5').hide();
            console.log("case1");
            document.getElementById('optionBox').value=2;
          }else if(self.props[xyz].numHouses==2){
            $('#opt-5').hide();
            $('#opt-4').hide();
            $('#opt-3').hide();
            $('#opt-2').show();
            $('#opt-1').show();
            $('#opt1').show();
            $('#opt2').show();
            $('#opt3').hide();
            $('#opt4').hide();
            $('#opt5').hide();
            console.log("case2");
            document.getElementById('optionBox').value=2;
          }else if(self.props[xyz].numHouses==3){
            $('#opt-5').hide();
            $('#opt-4').hide();
            $('#opt-3').show();
            $('#opt-2').show();
            $('#opt-1').show();
            $('#opt1').show();
            $('#opt2').hide();
            $('#opt3').hide();
            $('#opt4').hide();
            $('#opt5').hide();
            console.log("case3");
            document.getElementById('optionBox').value=-1;
          }else if(self.props[xyz].numHouses==4){
            $('#opt-5').hide();
            $('#opt-4').show();
            $('#opt-3').show();
            $('#opt-2').show();
            $('#opt-1').show();
            $('#opt1').hide();
            $('#opt2').hide();
            $('#opt3').hide();
            $('#opt4').hide();
            $('#opt5').show();
            console.log("case4");
            document.getElementById('optionBox').value=-1;
         }else if(self.props[xyz].numHouses==5){
            $('#opt-5').show();
            $('#opt-4').show();
            $('#opt-3').show();
            $('#opt-2').show();
            $('#opt-1').show();
            $('#opt1').hide();
            $('#opt2').hide();
            $('#opt3').hide();
            $('#opt4').hide();
            $('#opt5').hide();
            console.log("case5");
            document.getElementById('optionBox').value=-1;
          }
          document.getElementById("propname").innerHTML=str8;
          document.getElementById("buyhouse").style.display="none";
          document.getElementById("housenumber").style.display="block";
    }
      let annullaBuild=function(){
        document.getElementById("buyhouse").style.display="none";
        document.getElementById("gestore").style.display="block";
        let arr7 = document.getElementsByClassName("housebutton");
        for (let i = 0; i < arr7.length; i ++) {
          arr7[i].style.display="none";
        }
      }

      let caseComprate=function(){
          let newHouses=($("#optionBox").val()) * 1;
          self.props[xyz].numHouses+=newHouses;
          let pack=[self.props[xyz].id, newHouses];
          socket.emit('nuoveCase',pack);
          showHouseButton();
        }

        socket.on('updateHouses', function(data) {
          let player = data[0];
          let prop = data[1];
          let numHousesDelta = data[2];
          let str = player.name + ' added ' + numHousesDelta + ' to ' + prop.name;
          updateScroll(str);
          for (let i = 0; i < players.length; i ++) {
            if(players[i].id == player.id) {
              if(player.id != self.id) {
                let pl = players[i];
                for (let i = 0; i < pl.props.length; i ++) {
                  if (pl.props[i].id == prop.id) {
                    pl.props[i].numHouses += numHousesDelta;
                    pl.props[i].rent = prop.rent;
                  }
                }
                paint();
              } else {
                paint();
              }
            }
          }
        });
</script>
</body>
</html>
